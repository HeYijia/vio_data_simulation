# -*- coding: utf-8 -*-
"""
Created on Thu Jun 15 18:18:24 2017

@author: hyj
"""

import numpy as np
import matplotlib
import matplotlib.pyplot as plt
from mpl_toolkits.mplot3d import Axes3D
from GeometryLib import  drawCoordinateFrame, euler2Rbn,euler2Rnb
import transformations as tf

#a = np.loadtxt('/home/hyj/opencv project/vo2/bin/odom.txt')
#fig = plt.figure()
#ax = fig.add_subplot(111)  
#ax.plot(a)

point_id=[]
x=[]
y=[]
z=[]                                                                                                

with open('/home/hyj/slam_project/vio_sim/vio_data_sim/bin/all_points.txt', 'r') as f:   
    data = f.readlines()  #txt中所有字符串读入data  
  
    for line in data:  
        odom = line.split()        #将单个数据分隔开存好  
        numbers_float = map(float, odom) #转化为浮点数  
        x.append( numbers_float[0] )
        y.append( numbers_float[1] )
        z.append( numbers_float[2] )

x1=[]
y1=[]
z1=[]
with open('/home/hyj/slam_project/vio_sim/vio_data_sim/bin/keyframe/all_points_80.txt', 'r') as f:   
    data = f.readlines()  #txt中所有字符串读入data  
  
    for line in data:  
        odom = line.split()        #将单个数据分隔开存好  
        numbers_float = map(float, odom) #转化为浮点数  
        x1.append( numbers_float[0] )
        y1.append( numbers_float[1] )
        z1.append( numbers_float[2] )
    
    
position = []
quaterntions = []
timestamp = []
qw_index = 1
with open('/home/hyj/slam_project/vio_sim/vio_data_sim/bin/cam_pose.txt', 'r') as f:   #   imu_circle   imu_spline

    data = f.readlines()  #txt中所有字符串读入data    
    for line in data:  
        odom = line.split()        #将单个数据分隔开存好  
        numbers_float = map(float, odom) #转化为浮点数  

        #timestamp.append( numbers_float[0])        
        quaterntions.append( [numbers_float[qw_index], numbers_float[qw_index+1],numbers_float[qw_index+2],numbers_float[qw_index+3]   ] )   # qw,qx,qy,qz
        position.append( [numbers_float[qw_index+4], numbers_float[qw_index+5],numbers_float[qw_index+6] ] )              
              
## plot 3d        
fig = plt.figure()
plt.ion()
ax = fig.gca(projection='3d')

ax.set_xlabel('X')     
ax.set_ylabel('Y')
ax.set_zlabel('Z')
rpy = []
t = []
for i in range(0,400,5):
    ax.clear()    
    ax.scatter(x, y, z,c='g')
    
    x1=[]
    y1=[]
    z1=[]    
    rpy.append( tf.euler_from_quaternion(quaterntions[i]) )
    t.append( position[i] )
    p = position[i]
    for j in range(len(rpy)):
        drawCoordinateFrame(ax, rpy[j], t[j])    
    
    s = '/home/hyj/slam_project/vio_sim/vio_data_sim/bin/keyframe/all_points_' +str(i)+'.txt' 
    with open(s, 'r') as f:   
        data = f.readlines()  #txt中所有字符串读入data  
        for line in data:  
            odom = line.split()        #将单个数据分隔开存好  
            numbers_float = map(float, odom) #转化为浮点数  
            x1.append( numbers_float[0] )
            y1.append( numbers_float[1] )
            z1.append( numbers_float[2] )
            
            ax.plot( [ numbers_float[0],   p[0]  ] , [ numbers_float[1], p[1] ] , zs=[ numbers_float[2], p[2] ] )
        
    ax.scatter(x1, y1, z1,c='r',marker='^')
    ax.legend()
    plt.show() 
    plt.pause(0.05)
    
